<mat-accordion [multi]="true">
  <mat-expansion-panel #panel
    *ngFor="let group of groups; trackBy: trackByGroupId"
    [expanded]="(panelStates$ | async)[group.id] || (activeGroupId$ | async) === group.id && !isNaN(activeTabId$ | async) || panel.expanded"
    (opened)="opened(group.id)"
    (closed)="closed(group.id)"
    hideToggle>
    <mat-expansion-panel-header>
      <app-ripple *ngIf="(activeGroupId$ | async) === group.id && isNaN(activeTabId$ | async) as focused" 
        [focused]="focused">
      </app-ripple>
      <div class="collapsed">
        <app-panel-header
          *ngIf="tabsByHostname$ | async as tabsByHostname"
          [icons]="tabsByHostname[group.id]"
          [total]="group.tabs.length"
          [titleText]="(titlesMap$ | async)[group.id]"
          [pinned]="group.timestamp < 0"
          [readOnly]="!hasTabGroup(group)"
          (starred)="favGroup(group)">
        </app-panel-header>
      </div>
      <div class="expanded">
        <app-group-controls [group]="group" [readOnly]="!hasTabGroup(group)"></app-group-controls>
      </div>
    </mat-expansion-panel-header>
    <mat-divider></mat-divider>
    <app-tab-list *ngIf="group.tabs$ | async as tabs" cdkDropList (cdkDropListDropped)="drop($event, tabs)">
      <app-list-item
        cdkDrag
        *ngFor="let tab of tabs; trackBy: trackByTabId"
        [cdkDragDisabled]="dragDisabled"
        [tab]="tab"
        [focused]="(activeGroupId$ | async) === group.id && (activeTabId$ | async) === tab.id">
      </app-list-item>
    </app-tab-list>
  </mat-expansion-panel>
</mat-accordion>
