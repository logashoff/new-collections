<form [formGroup]="formGroup">
  <mat-card>
    <mat-card-content>
      <section class="section">
        <h3>{{ 'manageCollections' | translate }}</h3>
        <mat-hint>{{ 'hintCollections' | translate }}</mat-hint>
        <section class="storage-controls">
          @for (action of collectionActions; track action) {
            @if (action.color) {
              <button
                mat-flat-button
                [matTooltip]="action.tooltip"
                (click)="handleAction(action.action)"
                [color]="action.color"
              >
                {{ action.label }}
              </button>
            } @else {
              <button
                mat-stroked-button
                [matTooltip]="action.tooltip"
                (click)="handleAction(action.action)"
                [color]="action.color"
              >
                {{ action.label }}
              </button>
            }
          }
        </section>
      </section>
      <section class="section">
        @let storageUsage = storageUsage$ | async;

        <h3 class="storage-heading">{{ 'syncUsage' | translate }}</h3>
        <mat-hint>{{ 'hintDataUsage' | translate: (100 - storageUsage | number: '1.0-0') }}</mat-hint>
        <mat-progress-bar mode="determinate" [value]="storageUsage" [color]="storageUsage > 80 ? 'warn' : 'primary'" />
      </section>
      <section class="section toggles">
        <mat-slide-toggle formControlName="syncStorage" color="primary">
          <div class="toggle-label">{{ 'syncCollections' | translate }}</div>
          <mat-hint>{{ 'hintSyncCollections' | translate }}</mat-hint>
        </mat-slide-toggle>
        <mat-slide-toggle formControlName="enableDevices" color="primary">
          <div class="toggle-label">{{ 'enableDevices' | translate }}</div>
          <mat-hint>{{ 'hintShowDevices' | translate }}</mat-hint>
        </mat-slide-toggle>
        <mat-slide-toggle formControlName="enableTopSites" color="primary">
          <div class="toggle-label">{{ 'enableSites' | translate }}</div>
          <mat-hint>{{ 'hintShowTopSites' | translate }}</mat-hint>
        </mat-slide-toggle>
      </section>
      @if (ignoreSitesControl.controls?.length > 0 && sitesControl.value) {
        <section class="section">
          <h3 class="storage-heading">{{ 'ignoredSites' | translate }}</h3>
          <mat-hint>{{ 'hintIgnoredSites' | translate }}</mat-hint>
          <mat-list role="list" class="list">
            @for (ignoredSite of ignoreSitesControl.controls; track ignoredSite; let i = $index) {
              <mat-list-item role="listitem">
                <div class="list-item">
                  <span class="list-item-label">
                    {{ ignoredSite.value?.title }}
                  </span>
                  <button mat-icon-button (click)="ignoreSitesControl.removeAt(i)">
                    <mat-icon>close</mat-icon>
                  </button>
                </div>
              </mat-list-item>
            }
          </mat-list>
        </section>
      }
    </mat-card-content>
  </mat-card>
</form>
